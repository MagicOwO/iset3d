function block = piBlockExtractV3(txtLines,varargin)
% 
p = inputParser;
p.addRequired('txtLines',@(x)(iscell(txtLines) && ~isempty(txtLines)));
addParameter(p,'blockName','Camera',@ischar);
p.parse(txtLines,varargin{:});

blockName = p.Results.blockName;
%%
nLetters = length(blockName);
nLines = length(txtLines);
block = [];
%% Parse the string on the material line

for ii=1:nLines
    thisLine = txtLines{ii};
    if strncmpi(thisLine,blockName,nLetters)
        thisLine = textscan(thisLine,'%q');
        thisLine = thisLine{1};
        nStrings = length(thisLine);
        blockType = thisLine{1};
        blockSubtype = thisLine{2};
        block = struct('type',blockType,'subtype',blockSubtype);
        dd = 3;
        while dd <= nStrings
            if contains(thisLine{dd},' ')
                C = strsplit(thisLine{dd},' ');
                valueType = C{1};
                valueName = C{2};
            end
            value = thisLine{dd+1};
            
            % Convert value depending on type
            if(strcmp(valueType,'string'))
                % Do nothing.
                continue;
            elseif(strcmp(valueType,'integer'))
            elseif(strcmp(valueType,'float')))
                value = str2num(value);
            else
                error('Did not recognize value type, %s, when parsing PBRT file!',valueType);
            end
            
            tempStruct = struct('type',valueType,'value',value);
            block.(valueName) = tempStruct;
            dd = dd+2;
        end 
    end
end

% fprintf('Read %d materials on %d lines\n',cnt,nLines);

end